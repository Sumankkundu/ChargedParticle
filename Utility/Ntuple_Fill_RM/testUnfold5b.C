#include <iostream>
#include <fstream>
#include <cmath>
#include <array>
#include <vector>
#include <TArrayC.h>
#include <string>
#include "TH1.h"                                 // for histrograming
#include "TH2D.h"
#include "TH1F.h"
#include "TH2F.h"
#include "TVirtualPad.h"
#include "TApplication.h"
#include "TBranch.h"
#include "TBranchElement.h"
#include "TFile.h"                     // ROOT, for saving file.
#include  <string>
#include  <map>
#include "TTree.h"                     //for Tree file 
#include "TROOT.h"
#include <TMath.h>
#include <TCanvas.h>
#include <TRandom3.h>
#include <TFitter.h>
#include <TF1.h>
#include <TStyle.h>
#include <TVector.h>
#include <TGraph.h>
#include <map>
#include <cmath>
#include <TMath.h>
#include <TRandom3.h>
#include <TFile.h>
#include <TDirectoryFile.h>
#include <TTree.h>
#include <TH1D.h>
#include <TProfile.h>
#include <TH2D.h>
#include <TCanvas.h>
#include <THStack.h>
#include <TLegend.h>
#include <TStyle.h>
#include <TLorentzVector.h>

//#include "TUnfoldIterativeEM.h"
#include "TUnfoldBinning.h"
#include "TUnfoldBinningXML.h"
#include "TUnfoldDensity.h"
#include "TUnfold.h"
#include "TUnfoldSys.h"

using namespace std;
int getbinid(double val, int nbmx, double* array) {
  if (val<array[0]) return -2;
  for (int ix=0; ix<=nbmx; ix++) {
    if (val < array[ix]) return ix-1;
  }
  return -3;
}


void testUnfold5b(){  
  TH1::SetDefaultSumw2();
  TH2::SetDefaultSumw2();
 
  
  //TFile *filentuple = new TFile("ESV_Ntuple.root");
  TFile *filentuple = new TFile("/home/suman/Paradox/Charged_ESV/Working/ESV_dist/MC/PYTHIA8_2017/CP5_Flat_PY2017/Legacy/NTuple/16Sep20/PY8_UL17_Flat_NTuple_16Sep20.root");
  
  TFile *outputFile=new TFile("TUnfold_Ready.root","recreate");
 
  TDirectoryFile *Dir1 =new TDirectoryFile("Binning","Binning");
  TDirectoryFile *Dir2=new TDirectoryFile("analyzeBasicPat","Historgams");
  TDirectoryFile *Dir3=new TDirectoryFile("analyzeBasicPat1D","1D Historgams");

  int const type = 2;         // Jet & Charage particles
  const int nHLTmx=8; //HT2 Range
  //const int njetetamn=1;  //eta value used 2.4
  //double etarange[njetetamn] ={2.4}; //
  static const int nvar=32;  // Total number of eventshape variables
  static const int nusedvar = 5;   //Event Shape variables used
  Int_t var[nusedvar]={3,9,15,18,24};   // Names 3 Thrust , 9 Jet mass , 15 Y23 , 18 Jet Boardening , 24 Total Jet mass
  const int njetptmn = nHLTmx;

  const char* vartitle[nvar]={"Anti-Y_{23,C} ", "Anti-Y_{23,E} ", "Anti-Y_{23,R} ",
                              "#tau_{_{#perp}} ", "#tau_{_{#perp} _{   ,E}} ", "#tau_{_{#perp} _{   ,R}} ",
                              "T_{ m,C} ", "T_{ m,E} ", "T_{ m,R} ",
                              "#rho_{Tot} ", "#rho_{Tot,E} ", "#rho_{Tot,R} ",
                              "#rho_{H,C} ", "#rho_{H,E} ", "#rho_{H,R} ",
                              "Y_{23} ", "Y_{23,E} ", "Y_{23,R} ",
                              "B_{ T,C} ", "B_{ T,E} ", "B_{ T,R} ",
                              "B_{ W,C} ", "B_{ W,E} ", "B_{ W,R} ",
                              "#rho^{T}_{Tot} ", "#rho^{T}_{Tot,E} ", "#rho^{T}_{Tot,R} ",
                              "#rho^{T}_{H,C} ", "#rho^{T}_{H,E} ", "#rho^{T}_{H,R} ",
                              "S_{_{#perp} _{   ,C}}", "C-parameter_{C}"};

   double leadingPtThreshold[njetptmn+1] = {83, 109, 172, 241, 309, 377, 462, 570, 3000.0}; //Fit Value dijet trigger
   double htbins[nHLTmx+1] = {83, 109, 172, 241, 309, 377, 462, 570, 3000.0};
   //int rhtnbins[nHLTmx] = {6,12,12,12,12,16,20,50};
   int rhtnbins[nHLTmx] = {4,8,8,8,8,12,14,20};
   //int htnbins[nHLTmx] = {3,6,6,6,6,8,10,25};
   int htnbins[nHLTmx] = {3,4,4,4,4,6,7,10};

   
   
   
   TTree *TEsv = (TTree*)filentuple->Get("analyzeBasicPat/TEsv");
   // define the variables
   //Define the Variable for branchi
   float  ht2, eweight, ht2gen ;
   bool isreco, isgen;
   //   Double_t weight;  
   vector<Double_t>  *EJet = new vector<Double_t>;
   vector<Double_t>  *EChar = new vector<Double_t>;
   vector<Double_t>  *EJetgen = new vector<Double_t>;
   vector<Double_t> *EChargen= new vector<Double_t>;
   
   
   TEsv->SetBranchAddress("EJet", &EJet);
   TEsv->SetBranchAddress("EChar", &EChar);
   TEsv->SetBranchAddress("EJetgen", &EJetgen);
   TEsv->SetBranchAddress("EChargen", &EChargen);
   TEsv->SetBranchAddress("ht2", &ht2);
   TEsv->SetBranchAddress("ht2gen", &ht2gen);
   TEsv->SetBranchAddress("eweight", &eweight);
   TEsv->SetBranchAddress("isreco", &isreco);
   TEsv->SetBranchAddress("isgen", &isgen);
   
   Int_t nentry = Int_t(TEsv->GetEntries());
   cout << "Total Event count ="<< nentry << endl;
 //---------------------------------------------------------------Bins Edge
 const int rnmxbins=32;
//const int nmxbins=22; //Max bin in Charged

int rnbinsx0[nvar][nHLTmx]={{},{},{},
                   {22,24,26,26,28,28,30,32},//3
                   {},{},{},{},{},
                   {18,20,22,26,28,28,30,32},//9
                   {},{},{},{},{},
                   {8,8,10,12,12,14,14,14},//15
                   {},{},
                   {14,14,16,18,20,22,24,28},//18
                   {},{},{},{},{},
                   {14,16,18,20,22,24,26,26},//24
                   {},{},{},{},{},{},{}};
//For charge Particles
int rnbinsx1[nvar][nHLTmx]={{},{},{},
                   {20,20,20,20,18,18,18,14},//3
                   {},{},{},{},{},
                   {16,18,20,20,18,18,18,14},//9
                   {},{},{},{},{},
                   {8,8,8,8,8,8,8,8},//15
                   {},{},
                   {22,22,22,22,22,22,16,12},//18
                   {},{},{},{},{},
                   {12,12,14,14,14,14,14,12},//24
                   {},{},{},{},{},{},{}};
///////////////////Modify /////////////////////////////
//for Jets
double rbinrngs0[nvar][nHLTmx][rnmxbins+1] ={
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //Thrust 3
        {{-6.71, -6.01, -5.52, -5.13, -4.8, -4.51, -4.25, -4.01, -3.78, -3.56, -3.35, -3.15, -2.95, -2.76, -2.57, -2.39, -2.21, -2.04, -1.87, -1.71, -1.55, -1.4, -1.26 }, // 22
{-6.71, -6.12, -5.69, -5.34, -5.03, -4.76, -4.51, -4.28, -4.06, -3.84, -3.63, -3.42, -3.22, -3.02, -2.82, -2.63, -2.44, -2.25, -2.07, -1.9, -1.73, -1.57, -1.42, -1.29, -1.17}, //24
{-6.71, -6.26, -5.89, -5.58, -5.3, -5.04, -4.8, -4.57, -4.35, -4.14, -3.93, -3.72, -3.52, -3.32, -3.12, -2.92, -2.72, -2.53, -2.34, -2.16, -1.99, -1.83, -1.68, -1.54, -1.41, -1.29, -1.19}, //26
{-6.33, -6, -5.71, -5.44, -5.19, -4.95, -4.72, -4.5, -4.28, -4.07, -3.86, -3.65, -3.44, -3.24, -3.04, -2.84, -2.65, -2.46, -2.28, -2.11, -1.95, -1.8, -1.66, -1.53, -1.41, -1.31, -1.22}, //26
{-6.71, -6.36, -6.05, -5.76, -5.49, -5.24, -5, -4.76, -4.53, -4.31, -4.09, -3.87, -3.66, -3.45, -3.25, -3.05, -2.86, -2.67, -2.49, -2.32, -2.16, -2, -1.85, -1.72, -1.6, -1.49, -1.39, -1.3, -1.22}, // 28
{-6.71, -6.39, -6.09, -5.81, -5.54, -5.28, -5.03, -4.79, -4.56, -4.33, -4.11, -3.89, -3.68, -3.47, -3.27, -3.07, -2.88, -2.7, -2.52, -2.35, -2.19, -2.04, -1.9, -1.77, -1.65, -1.54, -1.44, -1.35, -1.26}, //28
{-6.71, -6.4, -6.11, -5.83, -5.56, -5.3, -5.05, -4.81, -4.57, -4.34, -4.12, -3.9, -3.69, -3.48, -3.28, -3.08, -2.89, -2.71, -2.54, -2.38, -2.23, -2.09, -1.95, -1.82, -1.7, -1.59, -1.49, -1.4, -1.32, -1.25, -1.19}, //30
{-6.71, -6.4, -6.11, -5.83, -5.56, -5.3, -5.05, -4.8, -4.56, -4.33, -4.11, -3.89, -3.68, -3.48, -3.28, -3.09, -2.91, -2.74, -2.58, -2.43, -2.29, -2.15, -2.02, -1.9, -1.79, -1.69, -1.6, -1.51, -1.43, -1.36, -1.3, -1.24, -1.19}}, //32
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //RhoT 9
        {{-5.75, -5.18, -4.71, -4.3, -3.94, -3.61, -3.3, -3.01, -2.73, -2.47, -2.22, -1.98, -1.75, -1.52, -1.31, -1.11, -0.92, -0.74, -0.57},// -0.42}, //18
{-5.75, -5.21, -4.78, -4.42, -4.1, -3.8, -3.52, -3.25, -2.99, -2.74, -2.49, -2.24, -2, -1.76, -1.53, -1.31, -1.1, -0.91, -0.73, -0.57, -0.43}, //20
{-5.75, -5.27, -4.89, -4.57, -4.28, -4.01, -3.76, -3.52, -3.28, -3.05, -2.82, -2.59, -2.36, -2.13, -1.91, -1.69, -1.48, -1.28, -1.09, -0.91, -0.75, -0.61, -0.49},// -0.38},//22
{-5.75, -5.33, -4.98, -4.68, -4.41, -4.16, -3.92, -3.69, -3.46, -3.24, -3.02, -2.8, -2.58, -2.36, -2.15, -1.94, -1.74, -1.54, -1.35, -1.17, -1, -0.85, -0.71, -0.59, -0.49, -0.4, -0.32},//26
{-5.75, -5.36, -5.03, -4.74, -4.48, -4.23, -4, -3.77, -3.55, -3.33, -3.11, -2.9, -2.69, -2.48, -2.27, -2.06, -1.86, -1.66, -1.47, -1.29, -1.12, -0.97, -0.83, -0.71, -0.6, -0.5, -0.42, -0.35, -0.29},//28
{-5.75, -5.4, -5.09, -4.81, -4.55, -4.31, -4.08, -3.86, -3.64, -3.43, -3.22, -3.01, -2.8, -2.6, -2.4, -2.2, -2.01, -1.82, -1.64, -1.46, -1.29, -1.13, -0.98, -0.84, -0.72, -0.61, -0.51, -0.42, -0.34}, //28
{-5.75, -5.43, -5.14, -4.87, -4.62, -4.38, -4.15, -3.93, -3.71, -3.5, -3.29, -3.08, -2.88, -2.68, -2.48, -2.28, -2.09, -1.9, -1.72, -1.55, -1.39, -1.24, -1.1, -0.97, -0.85, -0.74, -0.64, -0.55, -0.47, -0.4, -0.34}, //30
{-5.75, -5.45, -5.18, -4.92, -4.68, -4.45, -4.22, -4, -3.79, -3.58, -3.37, -3.17, -2.97, -2.77, -2.57, -2.38, -2.19, -2.01, -1.84, -1.67, -1.51, -1.36, -1.22, -1.09, -0.97, -0.86, -0.76, -0.67, -0.59, -0.52, -0.45, -0.39, -0.34} //32
},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
     //Y23
        {{-5.54, -4.99, -4.45, -3.91, -3.36, -2.81, -2.28, -1.81, -1.43 }, //8
{-5.54, -4.99, -4.45, -3.91, -3.36, -2.81, -2.28, -1.81, -1.43 }, //8
{-6.13, -5.56, -5.01, -4.47, -3.94, -3.42, -2.92, -2.45, -2.02, -1.65, -1.34 }, //10
{-6.71, -6.2, -5.67, -5.13, -4.6, -4.09, -3.6, -3.14, -2.72, -2.33, -1.97, -1.64, -1.33 }, //12
{-6.71, -6.12, -5.57, -5.05, -4.55, -4.08, -3.64, -3.22, -2.83, -2.46, -2.11, -1.79, -1.49 }, //12
{-6.71, -6.16, -5.63, -5.12, -4.64, -4.19, -3.77, -3.38, -3.01, -2.67, -2.34, -2.03, -1.73, -1.44, -1.15 }, //14
{-6.71, -6.18, -5.67, -5.18, -4.73, -4.31, -3.92, -3.56, -3.22, -2.9, -2.59, -2.3, -2.01, -1.73, -1.44}, //14
{-6.71, -6.17, -5.68, -5.24, -4.83, -4.45, -4.1, -3.77, -3.45, -3.15, -2.86, -2.58, -2.31, -2.04, -1.78 }}, //14 
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //BT
        {{-2.42, -2.25, -2.08, -1.92, -1.76, -1.6, -1.44, -1.28, -1.13, -0.98, -0.83, -0.68, -0.54, -0.4, -0.27},//14
{-2.71, -2.53, -2.35, -2.17, -1.99, -1.82, -1.65, -1.48, -1.31, -1.15, -0.99, -0.84, -0.7, -0.56, -0.43},//14
{-2.8, -2.61, -2.42, -2.23, -2.04, -1.86, -1.68, -1.51, -1.35, -1.19, -1.04, -0.9, -0.77, -0.65, -0.53, -0.42, -0.32}, //16
{-3, -2.8, -2.6, -2.4, -2.2, -2.01, -1.83, -1.66, -1.49, -1.33, -1.18, -1.04, -0.91, -0.79, -0.68, -0.58, -0.48, -0.39, -0.31},//18
{-3.19, -2.97, -2.75, -2.54, -2.34, -2.14, -1.95, -1.77, -1.6, -1.44, -1.29, -1.15, -1.02, -0.9, -0.79, -0.69, -0.59, -0.5, -0.42, -0.34, -0.27}, //20
{-3.38, -3.15, -2.92, -2.7, -2.49, -2.29, -2.1, -1.92, -1.75, -1.59, -1.44, -1.3, -1.17, -1.05, -0.94, -0.83, -0.73, -0.64, -0.55, -0.47, -0.39, -0.32, -0.25},//22
{-3.58, -3.34, -3.1, -2.87, -2.65, -2.44, -2.24, -2.05, -1.88, -1.72, -1.57, -1.43, -1.3, -1.18, -1.06, -0.95, -0.85, -0.76, -0.67, -0.59, -0.51, -0.43, -0.36, -0.29, -0.23}, //24
{-4.93, -4.68, -4.42, -4.15, -3.88, -3.62, -3.36, -3.11, -2.88, -2.66, -2.45, -2.26, -2.08, -1.91, -1.75, -1.61, -1.48, -1.35, -1.23, -1.12, -1.02, -0.92, -0.83, -0.75, -0.67, -0.59, -0.52, -0.45, -0.38}}, //28
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
       //RhoTT 24
        {{-5.89, -5.21, -4.66, -4.2, -3.8, -3.45, -3.14, -2.85, -2.59, -2.34, -2.1, -1.87, -1.64, -1.41, -1.18}, //14
{-5.89, -5.23, -4.73, -4.32, -3.97, -3.65, -3.36, -3.08, -2.82, -2.57, -2.33, -2.09, -1.86, -1.64, -1.43, -1.23, -1.04},//16
{-5.89, -5.3, -4.87, -4.52, -4.21, -3.93, -3.66, -3.41, -3.16, -2.92, -2.68, -2.45, -2.22, -2, -1.8, -1.61, -1.44, -1.28, -1.15}, //18
{-5.89, -5.37, -4.98, -4.65, -4.36, -4.09, -3.84, -3.6, -3.36, -3.13, -2.9, -2.68, -2.46, -2.25, -2.05, -1.86, -1.68, -1.52, -1.38, -1.26, -1.16},//20
{-5.89, -5.4, -5.03, -4.71, -4.43, -4.17, -3.93, -3.7, -3.47, -3.25, -3.03, -2.81, -2.6, -2.39, -2.19, -2, -1.82, -1.66, -1.51, -1.38, -1.27, -1.18, -1.1},//22
{-5.89, -5.46, -5.11, -4.81, -4.54, -4.29, -4.05, -3.82, -3.59, -3.37, -3.15, -2.94, -2.73, -2.53, -2.34, -2.15, -1.98, -1.82, -1.67, -1.54, -1.42, -1.32, -1.23, -1.16, -1.1}, //24
{-5.89, -5.5, -5.17, -4.88, -4.61, -4.36, -4.12, -3.89, -3.67, -3.45, -3.24, -3.03, -2.83, -2.64, -2.45, -2.27, -2.1, -1.94, -1.79, -1.66, -1.54, -1.43, -1.34, -1.26, -1.19, -1.13, -1.08},//26
{-5.89, -5.55, -5.24, -4.96, -4.7, -4.45, -4.22, -3.99, -3.77, -3.56, -3.36, -3.16, -2.97, -2.78, -2.6, -2.43, -2.27, -2.11, -1.96, -1.82, -1.7, -1.59, -1.49, -1.4, -1.31, -1.23, -1.16}}, //26    
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}}};



//-----------------------------------------------------------------------------------
//For charge particle
double rbinrngs1[nvar][nHLTmx][rnmxbins+1] ={
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //Thrust 3
        {{-5.08, -4.74, -4.46, -4.22, -4, -3.79, -3.59, -3.39, -3.19, -2.99, -2.79, -2.59, -2.39, -2.19, -1.99, -1.8, -1.62, -1.45, -1.3, -1.17, -1.06},//20
{-5.19, -4.87, -4.61, -4.37, -4.15, -3.94, -3.74, -3.54, -3.34, -3.13, -2.92, -2.71, -2.49, -2.28, -2.07, -1.87, -1.68, -1.51, -1.36, -1.23, -1.13}, //20
{-5.31, -5.03, -4.78, -4.55, -4.33, -4.11, -3.9, -3.69, -3.47, -3.25, -3.03, -2.81, -2.59, -2.37, -2.15, -1.94, -1.75, -1.57, -1.41, -1.27, -1.16},//20
{-5.54, -5.26, -5, -4.76, -4.52, -4.29, -4.06, -3.83, -3.6, -3.37, -3.14, -2.91, -2.68, -2.45, -2.23, -2.02, -1.82, -1.64, -1.48, -1.34, -1.22}, //20
{-5.54, -5.26, -4.99, -4.73, -4.47, -4.22, -3.97, -3.71, -3.45, -3.19, -2.94, -2.69, -2.45, -2.22, -2, -1.8, -1.62, -1.46, -1.32}, //18
{-5.54, -5.25, -4.97, -4.69, -4.42, -4.15, -3.88, -3.61, -3.34, -3.07, -2.8, -2.54, -2.29, -2.06, -1.85, -1.66, -1.49, -1.34, -1.22}, //18
{-5.66, -5.36, -5.06, -4.76, -4.46, -4.16, -3.86, -3.56, -3.27, -2.98, -2.7, -2.44, -2.19, -1.96, -1.75, -1.56, -1.4, -1.26, -1.14}, //18
{-5.43, -5.08, -4.73, -4.37, -4.01, -3.66, -3.32, -2.99, -2.67, -2.37, -2.1, -1.85, -1.63, -1.43, -1.26}},//14
	{{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //RhoT 9
        {{-5.75, -5.15, -4.62, -4.15, -3.72, -3.32, -2.95, -2.6, -2.27, -1.96, -1.67, -1.4, -1.15, -0.91, -0.69, -0.49, -0.31},//16
{-5.75, -5.17, -4.69, -4.26, -3.87, -3.5, -3.15, -2.81, -2.49, -2.18, -1.88, -1.59, -1.32, -1.07, -0.84, -0.63, -0.45, -0.29, -0.15 },//18
{-5.75, -5.24, -4.8, -4.41, -4.05, -3.7, -3.37, -3.05, -2.73, -2.42, -2.12, -1.83, -1.55, -1.29, -1.05, -0.84, -0.65, -0.48, -0.34, -0.22, -0.13 }, //20
{-5.75, -5.28, -4.87, -4.49, -4.13, -3.79, -3.46, -3.14, -2.82, -2.51, -2.21, -1.92, -1.64, -1.38, -1.14, -0.92, -0.72, -0.55, -0.4, -0.27, -0.16}, //20
{-5.75, -5.28, -4.86, -4.46, -4.08, -3.72, -3.37, -3.03, -2.7, -2.38, -2.07, -1.78, -1.5, -1.24, -1.01, -0.8, -0.62, -0.46, -0.33}, //18
{-5.75, -5.3, -4.88, -4.48, -4.1, -3.73, -3.37, -3.02, -2.68, -2.35, -2.03, -1.73, -1.45, -1.19, -0.95, -0.74, -0.55, -0.39, -0.25 }, //18
{-5.75, -5.3, -4.87, -4.45, -4.04, -3.65, -3.27, -2.9, -2.54, -2.2, -1.87, -1.56, -1.28, -1.02, -0.79, -0.59, -0.41, -0.26, -0.13 }, //18
{-5.75, -5.23, -4.73, -4.24, -3.77, -3.31, -2.87, -2.45, -2.05, -1.68, -1.34, -1.03, -0.76, -0.52, -0.31}}, //14
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //Y23 15
        {{-6.71, -5.96, -5.28, -4.66, -4.09, -3.56, -3.05, -2.54, -2.02},//8   //1.4 sigma
{-6.71, -5.96, -5.28, -4.66, -4.09, -3.56, -3.05, -2.54, -2.02},//8    //1.4 sigma
{-6.71, -6, -5.29, -4.62, -3.99, -3.39, -2.8, -2.19, -1.51 }, //8
{-6.71, -6, -5.33, -4.7, -4.1, -3.51, -2.93, -2.34, -1.71 }, //8
{-6.71, -5.99, -5.31, -4.67, -4.06, -3.47, -2.88, -2.28, -1.64 }, //8
{-6.71, -6.03, -5.37, -4.73, -4.11, -3.5, -2.89, -2.26, -1.58 }, //8
{-6.71, -6.04, -5.36, -4.69, -4.04, -3.41, -2.79, -2.15, -1.58 }, //8
{-6.71, -6.04, -5.36, -4.69, -4.04, -3.41, -2.79, -2.15, -1.58 }},//8
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //BT
        {{-4.83, -4.24, -3.85, -3.55, -3.3, -3.08, -2.88, -2.69, -2.51, -2.33, -2.16, -1.99, -1.82, -1.64, -1.46, -1.28, -1.1, -0.92, -0.75, -0.58, -0.42, -0.27, -0.14 }, //22
{-4.64, -4.17, -3.84, -3.57, -3.34, -3.13, -2.93, -2.74, -2.56, -2.38, -2.2, -2.02, -1.84, -1.66, -1.48, -1.29, -1.11, -0.93, -0.76, -0.6, -0.45, -0.31, -0.19 }, //22
{-4.83, -4.37, -4.04, -3.77, -3.54, -3.33, -3.13, -2.94, -2.75, -2.56, -2.37, -2.18, -1.99, -1.8, -1.6, -1.4, -1.21, -1.02, -0.84, -0.68, -0.53, -0.4, -0.29}, //22
{-4.93, -4.53, -4.21, -3.94, -3.7, -3.48, -3.27, -3.06, -2.86, -2.66, -2.46, -2.26, -2.06, -1.85, -1.65, -1.45, -1.25, -1.06, -0.88, -0.72, -0.57, -0.44, -0.33}, //22
{-4.93, -4.58, -4.28, -4.01, -3.75, -3.51, -3.27, -3.04, -2.81, -2.58, -2.35, -2.12, -1.89, -1.66, -1.44, -1.23, -1.03, -0.85, -0.69, -0.55, -0.43, -0.32, -0.23 }, //22
{-4.93, -4.62, -4.34, -4.07, -3.81, -3.56, -3.31, -3.07, -2.83, -2.59, -2.35, -2.11, -1.87, -1.64, -1.42, -1.21, -1.01, -0.83, -0.66, -0.51, -0.38, -0.27, -0.17 }, //23
{-3.77, -3.49, -3.21, -2.93, -2.66, -2.39, -2.13, -1.87, -1.62, -1.39, -1.17, -0.97, -0.79, -0.62, -0.47, -0.34, -0.23 }, //16
{-3.48, -3.14, -2.8, -2.47, -2.16, -1.86, -1.58, -1.32, -1.08, -0.86, -0.65, -0.46, -0.29}}, //12
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //RhoTT 24
        {{-5.89, -5.18, -4.59, -4.08, -3.63, -3.23, -2.87, -2.53, -2.21, -1.91, -1.62, -1.34, -1.07}, //12
{-5.89, -5.2, -4.66, -4.2, -3.79, -3.42, -3.07, -2.74, -2.42, -2.12, -1.83, -1.56, -1.31}, //12 
{-5.89, -5.27, -4.79, -4.38, -4.01, -3.66, -3.33, -3.01, -2.7, -2.4, -2.11, -1.84, -1.59, -1.36, -1.16}, //14
{-5.89, -5.33, -4.88, -4.49, -4.13, -3.79, -3.46, -3.14, -2.83, -2.53, -2.24, -1.96, -1.71, -1.48, -1.28},//14
{-5.89, -5.35, -4.89, -4.48, -4.1, -3.74, -3.39, -3.06, -2.74, -2.43, -2.14, -1.86, -1.61, -1.38, -1.18},//14
{-5.89, -5.39, -4.95, -4.54, -4.15, -3.78, -3.42, -3.07, -2.73, -2.41, -2.11, -1.83, -1.58, -1.36, -1.17},//14
{-5.89, -5.4, -4.95, -4.52, -4.11, -3.72, -3.35, -2.99, -2.65, -2.33, -2.03, -1.75, -1.49, -1.25, -1.04},//14
{-5.89, -5.42, -4.95, -4.49, -4.05, -3.63, -3.23, -2.86, -2.51, -2.18, -1.86, -1.55, -1.25}},//12
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}}};
//----------------------------------------------------for Gen

const int nmxbins=16;
//const int nmxbins=22; //Max bin in Charged

int nbinsx0[nvar][nHLTmx]={{},{},{},
                   {11,12,13,13,14,14,15,16},//3
                   {},{},{},{},{},
                   {9,10,11,13,14,14,15,16},//9
                   {},{},{},{},{},
                   {4,4,5,6,6,7,7,7},//15
                   {},{},
                   {7,7,8,9,10,11,12,14},//18
                   {},{},{},{},{},
                   {7,8,9,10,11,12,13,13},//24
                   {},{},{},{},{},{},{}};

//For charge Particles
int nbinsx1[nvar][nHLTmx]={{},{},{},
                   {10,10,10,10,9,9,9,7},//3
                   {},{},{},{},{},
                   {8,9,10,10,9,9,9,7},//9
                   {},{},{},{},{},
                   {4,4,4,4,4,4,4,4},//15
                   {},{},
                   {11,11,11,11,11,11,8,6},//18
                   {},{},{},{},{},
                   {6,6,7,7,7,7,7,6},//24
                   {},{},{},{},{},{},{}};
///////////////////Modify /////////////////////////////
//for Jets
double binrngs0[nvar][nHLTmx][nmxbins+1] ={
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //Thrust 3
        {{-6.71,-5.52,-4.8,-4.25,-3.78,-3.35,-2.95,-2.57,-2.21,-1.87,-1.55,-1.26},
{-6.71,-5.69,-5.03,-4.51,-4.06,-3.63,-3.22,-2.82,-2.44,-2.07,-1.73,-1.42,-1.17},
{-6.71,-5.89,-5.3,-4.8,-4.35,-3.93,-3.52,-3.12,-2.72,-2.34,-1.99,-1.68,-1.41,-1.19},
{-6.33,-5.71,-5.19,-4.72,-4.28,-3.86,-3.44,-3.04,-2.65,-2.28,-1.95,-1.66,-1.41,-1.22},
{-6.71,-6.05,-5.49,-5,-4.53,-4.09,-3.66,-3.25,-2.86,-2.49,-2.16,-1.85,-1.6,-1.39,-1.22},
{-6.71,-6.09,-5.54,-5.03,-4.56,-4.11,-3.68,-3.27,-2.88,-2.52,-2.19,-1.9,-1.65,-1.44,-1.26},
{-6.71,-6.11,-5.56,-5.05,-4.57,-4.12,-3.69,-3.28,-2.89,-2.54,-2.23,-1.95,-1.7,-1.49,-1.32,-1.19},
{-6.71,-6.11,-5.56,-5.05,-4.56,-4.11,-3.68,-3.28,-2.91,-2.58,-2.29,-2.02,-1.79,-1.6,-1.43,-1.3,-1.19}}, //32
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //RhoT 9
        {{-5.75,-4.71,-3.94,-3.3,-2.73,-2.22,-1.75,-1.31,-0.92,-0.57},
{-5.75,-4.78,-4.1,-3.52,-2.99,-2.49,-2,-1.53,-1.1,-0.73,-0.43},
{-5.75,-4.89,-4.28,-3.76,-3.28,-2.82,-2.36,-1.91,-1.48,-1.09,-0.75,-0.49},
{-5.75,-4.98,-4.41,-3.92,-3.46,-3.02,-2.58,-2.15,-1.74,-1.35,-1,-0.71,-0.49,-0.32},
{-5.75,-5.03,-4.48,-4,-3.55,-3.11,-2.69,-2.27,-1.86,-1.47,-1.12,-0.83,-0.6,-0.42,-0.29},
{-5.75,-5.09,-4.55,-4.08,-3.64,-3.22,-2.8,-2.4,-2.01,-1.64,-1.29,-0.98,-0.72,-0.51,-0.34},
{-5.75,-5.14,-4.62,-4.15,-3.71,-3.29,-2.88,-2.48,-2.09,-1.72,-1.39,-1.1,-0.85,-0.64,-0.47,-0.34},
{-5.75,-5.18,-4.68,-4.22,-3.79,-3.37,-2.97,-2.57,-2.19,-1.84,-1.51,-1.22,-0.97,-0.76,-0.59,-0.45,-0.34}
},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
     //Y23
        {{-5.54,-4.45,-3.36,-2.28,-1.43},
{-5.54,-4.45,-3.36,-2.28,-1.43},
{-6.13,-5.01,-3.94,-2.92,-2.02,-1.34},
{-6.71,-5.67,-4.6,-3.6,-2.72,-1.97,-1.33},
{-6.71,-5.57,-4.55,-3.64,-2.83,-2.11,-1.49},
{-6.71,-5.63,-4.64,-3.77,-3.01,-2.34,-1.73,-1.15},
{-6.71,-5.67,-4.73,-3.92,-3.22,-2.59,-2.01,-1.44},
{-6.71,-5.68,-4.83,-4.1,-3.45,-2.86,-2.31,-1.78}
}, //14 
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //BT
        {{-2.42,-2.08,-1.76,-1.44,-1.13,-0.83,-0.54,-0.27},
{-2.71,-2.35,-1.99,-1.65,-1.31,-0.99,-0.7,-0.43},
{-2.8,-2.42,-2.04,-1.68,-1.35,-1.04,-0.77,-0.53,-0.32},
{-3,-2.6,-2.2,-1.83,-1.49,-1.18,-0.91,-0.68,-0.48,-0.31},
{-3.19,-2.75,-2.34,-1.95,-1.6,-1.29,-1.02,-0.79,-0.59,-0.42,-0.27},
{-3.38,-2.92,-2.49,-2.1,-1.75,-1.44,-1.17,-0.94,-0.73,-0.55,-0.39,-0.25},
{-3.58,-3.1,-2.65,-2.24,-1.88,-1.57,-1.3,-1.06,-0.85,-0.67,-0.51,-0.36,-0.23},
{-4.93,-4.42,-3.88,-3.36,-2.88,-2.45,-2.08,-1.75,-1.48,-1.23,-1.02,-0.83,-0.67,-0.52,-0.38}
}, //28
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
       //RhoTT 24
        {{-5.89,-4.66,-3.8,-3.14,-2.59,-2.1,-1.64,-1.18},
{-5.89,-4.73,-3.97,-3.36,-2.82,-2.33,-1.86,-1.43,-1.04},
{-5.89,-4.87,-4.21,-3.66,-3.16,-2.68,-2.22,-1.8,-1.44,-1.15},
{-5.89,-4.98,-4.36,-3.84,-3.36,-2.9,-2.46,-2.05,-1.68,-1.38,-1.16},
{-5.89,-5.03,-4.43,-3.93,-3.47,-3.03,-2.6,-2.19,-1.82,-1.51,-1.27,-1.1},
{-5.89,-5.11,-4.54,-4.05,-3.59,-3.15,-2.73,-2.34,-1.98,-1.67,-1.42,-1.23,-1.1},
{-5.89,-5.17,-4.61,-4.12,-3.67,-3.24,-2.83,-2.45,-2.1,-1.79,-1.54,-1.34,-1.19,-1.08},
{-5.89,-5.24,-4.7,-4.22,-3.77,-3.36,-2.97,-2.6,-2.27,-1.96,-1.7,-1.49,-1.31,-1.16}
}, //26    
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}}};



//-----------------------------------------------------------------------------------
//For charge particle
double binrngs1[nvar][nHLTmx][nmxbins+1] ={
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //Thrust 3
        {{-5.08,-4.46,-4,-3.59,-3.19,-2.79,-2.39,-1.99,-1.62,-1.3,-1.06},
{-5.19,-4.61,-4.15,-3.74,-3.34,-2.92,-2.49,-2.07,-1.68,-1.36,-1.13},
{-5.31,-4.78,-4.33,-3.9,-3.47,-3.03,-2.59,-2.15,-1.75,-1.41,-1.16},
{-5.54,-5,-4.52,-4.06,-3.6,-3.14,-2.68,-2.23,-1.82,-1.48,-1.22},
{-5.54,-4.99,-4.47,-3.97,-3.45,-2.94,-2.45,-2,-1.62,-1.32},
{-5.54,-4.97,-4.42,-3.88,-3.34,-2.8,-2.29,-1.85,-1.49,-1.22},
{-5.66,-5.06,-4.46,-3.86,-3.27,-2.7,-2.19,-1.75,-1.4,-1.14},
{-5.43,-4.73,-4.01,-3.32,-2.67,-2.1,-1.63,-1.26}
},//14
	{{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //RhoT 9
        {{-5.75,-4.62,-3.72,-2.95,-2.27,-1.67,-1.15,-0.69,-0.31},
{-5.75,-4.69,-3.87,-3.15,-2.49,-1.88,-1.32,-0.84,-0.45,-0.15},
{-5.75,-4.8,-4.05,-3.37,-2.73,-2.12,-1.55,-1.05,-0.65,-0.34,-0.13},
{-5.75,-4.87,-4.13,-3.46,-2.82,-2.21,-1.64,-1.14,-0.72,-0.4,-0.16},
{-5.75,-4.86,-4.08,-3.37,-2.7,-2.07,-1.5,-1.01,-0.62,-0.33},
{-5.75,-4.88,-4.1,-3.37,-2.68,-2.03,-1.45,-0.95,-0.55,-0.25},
{-5.75,-4.87,-4.04,-3.27,-2.54,-1.87,-1.28,-0.79,-0.41,-0.13},
{-5.75,-4.73,-3.77,-2.87,-2.05,-1.34,-0.76,-0.31}
}, //14
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //Y23 15
        {{-6.71,-5.28,-4.09,-3.05,-2.02},
{-6.71,-5.28,-4.09,-3.05,-2.02},
{-6.71,-5.29,-3.99,-2.8,-1.51},
{-6.71,-5.33,-4.1,-2.93,-1.71},
{-6.71,-5.31,-4.06,-2.88,-1.64},
{-6.71,-5.37,-4.11,-2.89,-1.58},
{-6.71,-5.36,-4.04,-2.79,-1.58},
{-6.71,-5.36,-4.04,-2.79,-1.58}
},//8
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //BT
        {{-4.83,-3.85,-3.3,-2.88,-2.51,-2.16,-1.82,-1.46,-1.1,-0.75,-0.42,-0.14},
{-4.64,-3.84,-3.34,-2.93,-2.56,-2.2,-1.84,-1.48,-1.11,-0.76,-0.45,-0.19},
{-4.83,-4.04,-3.54,-3.13,-2.75,-2.37,-1.99,-1.6,-1.21,-0.84,-0.53,-0.29},
{-4.93,-4.21,-3.7,-3.27,-2.86,-2.46,-2.06,-1.65,-1.25,-0.88,-0.57,-0.33},
{-4.93,-4.28,-3.75,-3.27,-2.81,-2.35,-1.89,-1.44,-1.03,-0.69,-0.43,-0.23},
{-4.93,-4.34,-3.81,-3.31,-2.83,-2.35,-1.87,-1.42,-1.01,-0.66,-0.38,-0.17},
{-3.77,-3.21,-2.66,-2.13,-1.62,-1.17,-0.79,-0.47,-0.23},
{-3.48,-2.8,-2.16,-1.58,-1.08,-0.65,-0.29}
}, //12
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        //RhoTT 24
        {{-5.89,-4.59,-3.63,-2.87,-2.21,-1.62,-1.07},
{-5.89,-4.66,-3.79,-3.07,-2.42,-1.83,-1.31},
{-5.89,-4.79,-4.01,-3.33,-2.7,-2.11,-1.59,-1.16},
{-5.89,-4.88,-4.13,-3.46,-2.83,-2.24,-1.71,-1.28},
{-5.89,-4.89,-4.1,-3.39,-2.74,-2.14,-1.61,-1.18},
{-5.89,-4.95,-4.15,-3.42,-2.73,-2.11,-1.58,-1.17},
{-5.89,-4.95,-4.11,-3.35,-2.65,-2.03,-1.49,-1.04},
{-5.89,-4.95,-4.05,-3.23,-2.51,-1.86,-1.25}
},//12
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}},
        {{},{},{},{},{},{},{},{}}};
//--------------------------------------------------------------------------------------
/*

//gen bincreator 
 for(int ivar=0; ivar < nusedvar ; ivar++){
       cout <<endl << "{";
	for(int ipt = 0 ; ipt < njetptmn ; ipt++){
 for (int ibins =0; ibins <= nbinsx0[var[ivar]][ipt] ; ibins++){
    if (ibins%2==0){cout << binrngs0[var[ivar]][ipt][ibins];
        if(ibins<nbinsx0[var[ivar]][ipt]) cout << ",";
    }
         }
       cout <<"},"<< endl ;
	}
    }

cout <<" Charged" <<endl;
//gen bincreator
 for(int ivar=0; ivar < nusedvar ; ivar++){
       cout <<endl << "{";
        for(int ipt = 0 ; ipt < njetptmn ; ipt++){
 for (int ibins =0; ibins <= nbinsx1[var[ivar]][ipt] ; ibins++) {
    if (ibins%2==0){cout << binrngs1[var[ivar]][ipt][ibins];
        if(ibins<nbinsx1[var[ivar]][ipt]) cout << ",";
    }
         }
       cout <<"},"<< endl;
        }
    }
*/
//----------------------------------------------------For 1D
   TH1* h_recoevtvar_1D[type][nusedvar][nHLTmx]; //Reco
   TH1* h_recoevtfake_1D[type][nusedvar][nHLTmx];//For fake
   TH1* h_genevtmiss_1D[type][nusedvar][nHLTmx]; //For Miss
   TH1* h_genevtvar_1D[type][nusedvar][nHLTmx]; //Gen
   TH2  *RM_1D[type][nusedvar][nHLTmx];

//---------------------------------------------------For 2D
   TH1* h_recoevtvar[type][nusedvar][nHLTmx]; //Reco
   TH1* h_recoevtfake[type][nusedvar][nHLTmx];//For fake
   TH1* h_genevtmiss[type][nusedvar][nHLTmx]; //For Miss
   TH1* h_genevtvar[type][nusedvar][nHLTmx]; //Gen
   TH2  *RM[type][nusedvar][nHLTmx];
   
   
   TH1* outputvar[type][nusedvar][nHLTmx];
   TH1* extractvar[type][nusedvar][nHLTmx];
   TH1* projectvar[type][nusedvar][nHLTmx];
   
   char histname[100], name[100], title[100];
   char Axisname[100];
   char RecoBinName[100], GenBinName[100];
   
   TUnfoldBinning *binsRec[type][nusedvar][nHLTmx];
   TUnfoldBinning *RecoBinning[type][nusedvar][nHLTmx];
   
   TUnfoldBinning *binsGen[type][nusedvar][nHLTmx];
   TUnfoldBinning *GenBinning[type][nusedvar][nHLTmx];
   
   //Read Input Data MC and Response matrix
   for(int ity=0; ity <type; ity++){
     for(int ivar=0; ivar < nusedvar ; ivar++){
       for(int ipt = 0 ; ipt < njetptmn ; ipt++){
	 sprintf(RecoBinName, "detector_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 binsRec[ity][ivar][ipt] = new TUnfoldBinning(RecoBinName);
	 
	 sprintf(RecoBinName, "Recobin_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 RecoBinning[ity][ivar][ipt]= binsRec[ity][ivar][ipt]->AddBinning(RecoBinName);
	 
	 // sprintf(Axisname, "%s", vartitle[var[ivar]]);
	 sprintf(Axisname, "var_%i", var[ivar]);
	 RecoBinning[ity][ivar][ipt]->AddAxis(Axisname,(ity==0) ? rnbinsx0[var[ivar]][ipt] : rnbinsx1[var[ivar]][ipt],(ity==0) ? rbinrngs0[var[ivar]][ipt]: rbinrngs1[var[ivar]][ipt], false, false);
	 
	 //sprintf(Axisname, "%s", "H_{T,2}");
	 sprintf(Axisname, "ht_%i", ipt);
	 RecoBinning[ity][ivar][ipt]->AddAxis(Axisname, rhtnbins[ipt], htbins[ipt], htbins[ipt+1], false, false);
       }
     }
   }
   
   for(int ity=0; ity <type; ity++){
     for(int ivar=0; ivar < nusedvar ; ivar++){
       for(int ipt = 0 ; ipt < njetptmn ; ipt++){
	 sprintf(GenBinName, "Generator_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 binsGen[ity][ivar][ipt] = new TUnfoldBinning(GenBinName);
	 
	 sprintf(GenBinName, "Genbin_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 GenBinning[ity][ivar][ipt]= binsGen[ity][ivar][ipt]->AddBinning(GenBinName);
	 
	 //sprintf(Axisname, "%s", vartitle[var[ivar]]);
	 sprintf(Axisname, "var_%i", var[ivar]);
	 GenBinning[ity][ivar][ipt]->AddAxis(Axisname,(ity==0) ? nbinsx0[var[ivar]][ipt] : nbinsx1[var[ivar]][ipt],(ity==0) ? binrngs0[var[ivar]][ipt]: binrngs1[var[ivar]][ipt], true,true);
	 
	 //sprintf(Axisname, "%s", "H_{T,2}");
	 sprintf(Axisname, "ht_%i", ipt);
	 GenBinning[ity][ivar][ipt]->AddAxis(Axisname, htnbins[ipt], htbins[ipt], htbins[ipt+1], true, true);
       }
     }
   }
 Dir1->cd(); 
   //Create and book histograms for reco  and gen
   for(int ity=0; ity <type; ity++){
     for(int ivar=0; ivar < nusedvar ; ivar++){
       for(int ipt = 0 ; ipt < njetptmn ; ipt++){
	 //-------------------------------1D

	 sprintf(histname, "reco_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 sprintf(title, "reco type %i pt%i eta0 %i", ity, ipt, var[ivar]);
         h_recoevtvar_1D[ity][ivar][ipt] = new TH1D(histname, title, (ity==0) ? rnbinsx0[var[ivar]][ipt] : rnbinsx1[var[ivar]][ipt], (ity==0) ? rbinrngs0[var[ivar]][ipt] : rbinrngs1[var[ivar]][ipt]); 
	 sprintf(histname, "fake_reco_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
         sprintf(title, "fake reco type %i pt%i eta0 %i", ity, ipt, var[ivar]);
         h_recoevtfake_1D[ity][ivar][ipt] = new TH1D(histname, title, (ity==0) ? rnbinsx0[var[ivar]][ipt]: rnbinsx1[var[ivar]][ipt], (ity==0) ? rbinrngs0[var[ivar]][ipt] : rbinrngs1[var[ivar]][ipt]);
	 sprintf(histname, "gen_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
         sprintf(title, "gen type %i pt%i eta0 %i", ity, ipt, var[ivar]);
         h_genevtvar_1D[ity][ivar][ipt] = new TH1D(histname, title, (ity==0) ? nbinsx0[var[ivar]][ipt] : nbinsx1[var[ivar]][ipt], (ity==0) ? binrngs0[var[ivar]][ipt] : binrngs1[var[ivar]][ipt] );
	 sprintf(histname, "miss_gen_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
         sprintf(title, "miss gen type %i pt%i eta0 %i", ity, ipt, var[ivar]);
         h_genevtmiss_1D[ity][ivar][ipt] = new TH1D(histname, title, (ity==0) ? nbinsx0[var[ivar]][ipt] : nbinsx1[var[ivar]][ipt], (ity==0) ? binrngs0[var[ivar]][ipt] : binrngs1[var[ivar]][ipt]);
         sprintf(histname, "corr_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
         sprintf(title, "corr type %i pt%i eta0 %i", ity, ipt, var[ivar]);
	 RM_1D[ity][ivar][ipt] = new TH2D(histname, title, (ity==0) ? rnbinsx0[var[ivar]][ipt]: rnbinsx1[var[ivar]][ipt], (ity==0) ? rbinrngs0[var[ivar]][ipt] : rbinrngs1[var[ivar]][ipt], (ity==0) ? nbinsx0[var[ivar]][ipt] : nbinsx1[var[ivar]][ipt], (ity==0) ? binrngs0[var[ivar]][ipt] : binrngs1[var[ivar]][ipt]);


	 //----------------------------------2D
	  binsRec[ity][ivar][ipt]->PrintStream(cout);
	 binsRec[ity][ivar][ipt]->Write();
	 binsGen[ity][ivar][ipt]->Write();
	 
	 sprintf(histname, "reco_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 h_recoevtvar[ity][ivar][ipt] = binsRec[ity][ivar][ipt]->CreateHistogram(histname);//, true);
	 
	 sprintf(histname, "fake_reco_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 h_recoevtfake[ity][ivar][ipt] = binsRec[ity][ivar][ipt]->CreateHistogram(histname);//, true);
	 
	 
	 sprintf(histname, "gen_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 h_genevtvar[ity][ivar][ipt] = binsGen[ity][ivar][ipt]->CreateHistogram(histname);// true);
	 
	 sprintf(histname, "miss_gen_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 h_genevtmiss[ity][ivar][ipt] = binsGen[ity][ivar][ipt]->CreateHistogram(histname);// true);
	 
	 sprintf(histname, "corr_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 sprintf(Axisname, "%s", vartitle[var[ivar]]);
	 RM[ity][ivar][ipt] = TUnfoldBinning::CreateHistogramOfMigrations(binsRec[ity][ivar][ipt], binsGen[ity][ivar][ipt], histname ,0,0, Axisname); 
	 
	 sprintf(histname, "projectionX_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 outputvar[ity][ivar][ipt] = RM[ity][ivar][ipt]->ProjectionX(histname, 0, -1);
	 
	 sprintf(histname, "Extract_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 sprintf(RecoBinName, "Recobin_typ_%i_pt%i_eta0_%i", ity, ipt, var[ivar]);
	 //sprintf(Axisname, "%s", vartitle[var[ivar]]);
	 //sprintf(Axisname, "ht_%i", ipt);
	 
	 sprintf(Axisname, "var_%i", var[ivar]);
	 extractvar[ity][ivar][ipt] = binsRec[ity][ivar][ipt]->FindNode(RecoBinName)->ExtractHistogram(histname,h_recoevtvar[ity][ivar][ipt],0,true);
	 //extractvar[ity][ivar][ipt]->Write();
	 
	 //  projectvar[ity][ivar][ipt] = extractvar[ity][ivar][ipt]->ProjectionX(histname, 0, -1);
	 //  projectvar[ity][ivar][ipt]->Write();
       }
     }
   }
   
   cout << "Binning Complete" <<endl;
   
   
   //Fill Histogram
 for (Int_t i=0; i<nentry ; i++){
     bool isGEN = false; bool isRECO =false;
     float weight=-1; float HT2=-1; float HT2gen =-1;
     
     TEsv->GetEntry(i);
     
     isGEN = isgen;
     isRECO = isreco;
     weight=eweight;
     HT2= ht2; HT2gen =ht2gen;
     cout << "ievt = " << i <<" ";
     cout << "isGEN = " << isGEN << " isRECO = " << isRECO ;
     cout << " HT2 = " << HT2 << " HT2gen = " << ht2gen << "  "; 

     //Get Bin ID
     int irecoht = getbinid(HT2, nHLTmx, htbins);
     int igenht = getbinid(HT2gen, nHLTmx, htbins);
     if(irecoht< 0 && igenht < 0) continue;
     int irecovar[type] ={0}; int igenvar[type] ={0};
     irecovar[0]= EJet->size();  irecovar[1]= EChar->size(); 
     igenvar[0] = EJetgen->size() ;  igenvar[1]= EChargen->size();
     double recovar[type][nusedvar]={0}; double genvar[type][nusedvar]={0};
     
     cout <<" Reco HT2 Bin = " << irecoht << " Gen HT2 Bin = " << igenht << endl;

     //Read The ESV 
     for(int ity =0; ity< type ; ity++){
       for(int ivar=0; ivar < nusedvar ; ivar++){
	 if(ity==0){ 
	   if( isRECO && irecovar[ity]==nusedvar){recovar[ity][ivar] =EJet->at(ivar);}
	   if(isGEN && igenvar[ity]==nusedvar){genvar[ity][ivar] =EJetgen->at(ivar);}
	 }
	 if(ity==1){
	   if(isRECO && irecovar[ity]==nusedvar){recovar[ity][ivar] =EChar->at(ivar);}
	   if(isGEN && igenvar[ity]==nusedvar){genvar[ity][ivar] =EChargen->at(ivar);}
	 }
       }
     }
     
 //Fill The hist
     for(int ity =0; ity< type ; ity++){
       //fill reco
       if(isRECO && irecovar[ity]==nusedvar){
	 for(int ivar=0; ivar < nusedvar ; ivar++){
	   int igobbin =  RecoBinning[ity][ivar][irecoht]->GetGlobalBinNumber(recovar[ity][ivar],HT2);
    //      if(ity==0 && ivar==0){cout << " Reco : " << recovar[ity][ivar] << " " << HT2 ;} 
	   h_recoevtvar[ity][ivar][irecoht]->Fill(igobbin, weight);
	   h_recoevtvar_1D[ity][ivar][irecoht]->Fill(recovar[ity][ivar],weight);
	 }
       }

       //fill Gen
       if(isGEN && igenvar[ity]==nusedvar){
	 for(int ivar=0; ivar < nusedvar ; ivar++){
	   int igobbin = GenBinning[ity][ivar][igenht]->GetGlobalBinNumber(genvar[ity][ivar],HT2gen);
  //        if(ity==0 && ivar==0){cout << " Gen : " << genvar[ity][ivar] << " " << HT2gen ;} 
	   h_genevtvar[ity][ivar][igenht]->Fill(igobbin, weight);
	   h_genevtvar_1D[ity][ivar][igenht]->Fill(genvar[ity][ivar], weight);
	 }
       }
       
for(int ivar=0; ivar < nusedvar ; ivar++){
       if(isRECO && isGEN && irecovar[ity]==nusedvar && igenvar[ity]==nusedvar && irecoht == igenht){
	   int igobbinx = RecoBinning[ity][ivar][irecoht]->GetGlobalBinNumber(recovar[ity][ivar],HT2);
	   int igobbiny = GenBinning[ity][ivar][irecoht]->GetGlobalBinNumber(genvar[ity][ivar],HT2gen);
	   RM[ity][ivar][irecoht]->Fill(igobbinx,igobbiny, weight);
	   RM_1D[ity][ivar][irecoht]->Fill(recovar[ity][ivar], genvar[ity][ivar], weight);
      //    if(ity==0 && ivar==0){cout << " corr : " << recovar[ity][ivar] << " " << HT2  <<" " << genvar[ity][ivar] << " " << HT2gen ;} 
       }else {
	if(isRECO &&  irecovar[ity]==nusedvar) {
	   int igobbin =  RecoBinning[ity][ivar][irecoht]->GetGlobalBinNumber(recovar[ity][ivar],HT2);
	   h_recoevtfake[ity][ivar][irecoht]->Fill(igobbin, weight);    
	   h_recoevtfake_1D[ity][ivar][irecoht]->Fill(recovar[ity][ivar],weight);
    //      if(ity==0 && ivar==0){cout << " Reco fake : " << recovar[ity][ivar] << " " << HT2 ;} 
       }
       	if (isGEN && igenvar[ity]==nusedvar){
	   int igobbin = GenBinning[ity][ivar][igenht]->GetGlobalBinNumber(genvar[ity][ivar],HT2gen);
	   h_genevtmiss[ity][ivar][igenht]->Fill(igobbin, weight);
	   h_genevtmiss_1D[ity][ivar][igenht]->Fill(genvar[ity][ivar], weight);
  //        if(ity==0 && ivar==0){cout << " Gen miss : " << genvar[ity][ivar] << " " << HT2gen << endl;} 
         }
       }
} 
//cout << endl;
     } // for(int ity =0; ity< type ; ity++)
     
   } // for (Int_t i=0; i<nentry ; i++)
 

Dir2->cd();
for(int ity=0; ity <type; ity++){
   for(int ivar=0; ivar < nusedvar ; ivar++){
     for(int ipt = 0 ; ipt < njetptmn ; ipt++){
        h_recoevtvar[ity][ivar][ipt]->Write();
        h_recoevtfake[ity][ivar][ipt]->Write();
        h_genevtvar[ity][ivar][ipt]->Write();
        h_genevtmiss[ity][ivar][ipt]->Write();
        RM[ity][ivar][ipt]->Write();
       }
     }
   }

Dir3->cd();
for(int ity=0; ity <type; ity++){
   for(int ivar=0; ivar < nusedvar ; ivar++){
     for(int ipt = 0 ; ipt < njetptmn ; ipt++){
        h_recoevtvar_1D[ity][ivar][ipt]->Write();
        h_recoevtfake_1D[ity][ivar][ipt]->Write();
        h_genevtvar_1D[ity][ivar][ipt]->Write();
        h_genevtmiss_1D[ity][ivar][ipt]->Write();
        RM_1D[ity][ivar][ipt]->Write();
       }
     }
   }


   
   
   outputFile->Close();
   delete outputFile;
}//end
